---
title: "图像生成"
description: "为智能体集成图像创作能力"
---

# 图像生成

图像生成（Drawing）是智能体的创意能力之一，通过集成CogView等图像生成模型，让AI能够根据文本描述创作图像、设计图标、生成插画等视觉内容。

## 功能特性

### 文本到图像
- 根据自然语言描述生成图像
- 支持多种艺术风格
- 高质量图像输出
- 快速生成响应

### 多样化风格
- 写实风格
- 卡通动漫
- 抽象艺术
- 科技感设计
- 传统绘画风格

### 灵活控制
- 图像尺寸调整
- 风格强度控制
- 细节程度设置
- 色彩偏好指定

## 基础用法

### API调用示例

```bash
curl -X POST "https://open.bigmodel.cn/api/paas/v4/chat/completions" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "model": "glm-4-plus",
    "messages": [
      {
        "role": "user",
        "content": "请帮我画一幅夕阳下的海边风景，要有椰子树和沙滩"
      }
    ],
    "tools": [
      {
        "type": "drawing_tool",
        "drawing_tool": {
          "enable": true
        }
      }
    ]
  }'
```

### Python实现

```python
import requests
import json
import base64
from typing import Dict, List, Optional
from PIL import Image
import io

class ImageGenerationAgent:
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.chat_url = "https://open.bigmodel.cn/api/paas/v4/chat/completions"
        self.image_url = "https://open.bigmodel.cn/api/paas/v4/images/generations"
    
    def generate_image(self, prompt: str, size: str = "1024x1024", 
                      style: str = "natural", quality: str = "standard") -> Dict:
        """
        生成图像
        
        Args:
            prompt: 图像描述
            size: 图像尺寸 ("1024x1024", "1024x1792", "1792x1024")
            style: 风格 ("natural", "vivid")
            quality: 质量 ("standard", "hd")
        
        Returns:
            包含图像信息的字典
        """
        headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {self.api_key}"
        }
        
        data = {
            "model": "cogview-3",
            "prompt": prompt,
            "size": size,
            "style": style,
            "quality": quality,
            "n": 1
        }
        
        response = requests.post(self.image_url, headers=headers, json=data)
        result = response.json()
        
        if 'data' in result and len(result['data']) > 0:
            return {
                "success": True,
                "image_url": result['data'][0]['url'],
                "revised_prompt": result['data'][0].get('revised_prompt', prompt)
            }
        else:
            return {
                "success": False,
                "error": result.get('error', {}).get('message', '生成失败')
            }
    
    def generate_with_chat(self, description: str) -> Dict:
        """
        通过对话生成图像
        """
        headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {self.api_key}"
        }
        
        data = {
            "model": "glm-4-plus",
            "messages": [
                {
                    "role": "user",
                    "content": description
                }
            ],
            "tools": [
                {
                    "type": "drawing_tool",
                    "drawing_tool": {
                        "enable": True
                    }
                }
            ]
        }
        
        response = requests.post(self.chat_url, headers=headers, json=data)
        result = response.json()
        
        return self._parse_chat_response(result)
    
    def _parse_chat_response(self, response: Dict) -> Dict:
        """
        解析对话响应中的图像信息
        """
        if 'choices' not in response:
            return {"success": False, "error": "无效响应"}
        
        message = response['choices'][0]['message']
        
        result = {
            "success": True,
            "content": message.get('content', ''),
            "images": []
        }
        
        # 检查工具调用结果
        if 'tool_calls' in message:
            for tool_call in message['tool_calls']:
                if tool_call['type'] == 'drawing_tool':
                    # 提取图像信息
                    drawing_result = tool_call.get('drawing_tool', {})
                    if 'image_url' in drawing_result:
                        result['images'].append({
                            "url": drawing_result['image_url'],
                            "description": drawing_result.get('description', '')
                        })
        
        return result
    
    def download_image(self, image_url: str, save_path: str) -> bool:
        """
        下载图像到本地
        """
        try:
            response = requests.get(image_url)
            response.raise_for_status()
            
            with open(save_path, 'wb') as f:
                f.write(response.content)
            
            return True
        except Exception as e:
            print(f"下载图像失败: {e}")
            return False
    
    def enhance_prompt(self, simple_prompt: str) -> str:
        """
        增强提示词
        """
        enhancement_request = f"""
        请帮我优化这个图像生成提示词，使其更加详细和具体：
        
        原始提示词：{simple_prompt}
        
        请添加：
        1. 更具体的视觉细节
        2. 艺术风格描述
        3. 光线和色彩信息
        4. 构图建议
        
        只返回优化后的提示词，不要其他解释。
        """
        
        headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {self.api_key}"
        }
        
        data = {
            "model": "glm-4-plus",
            "messages": [
                {"role": "user", "content": enhancement_request}
            ],
            "temperature": 0.7
        }
        
        response = requests.post(self.chat_url, headers=headers, json=data)
        result = response.json()
        
        if 'choices' in result:
            return result['choices'][0]['message']['content'].strip()
        
        return simple_prompt

# 使用示例
agent = ImageGenerationAgent("your_api_key")

# 直接生成图像
result = agent.generate_image(
    prompt="一只可爱的橙色小猫坐在窗台上，阳光透过窗户洒在它身上，背景是绿色的花园",
    size="1024x1024",
    style="natural",
    quality="hd"
)

if result['success']:
    print(f"图像生成成功: {result['image_url']}")
    # 下载图像
    agent.download_image(result['image_url'], "cute_cat.png")
else:
    print(f"生成失败: {result['error']}")

# 通过对话生成
chat_result = agent.generate_with_chat(
    "请帮我画一幅科幻风格的城市夜景，要有霓虹灯和飞行汽车"
)

print(json.dumps(chat_result, indent=2, ensure_ascii=False))
```

## 应用场景

### 1. 内容创作

```python
class ContentCreationAgent(ImageGenerationAgent):
    def create_blog_illustration(self, article_title: str, article_summary: str) -> Dict:
        """
        为博客文章创建插图
        """
        prompt = f"""
        请为以下博客文章创建一幅插图：
        
        标题：{article_title}
        摘要：{article_summary}
        
        要求：
        1. 风格现代简洁
        2. 色彩搭配和谐
        3. 能够体现文章主题
        4. 适合作为文章头图
        """
        
        return self.generate_with_chat(prompt)
    
    def create_social_media_post(self, product_name: str, key_features: List[str]) -> Dict:
        """
        创建社交媒体宣传图
        """
        features_text = "、".join(key_features)
        
        prompt = f"""
        请为产品 "{product_name}" 创建一幅社交媒体宣传图：
        
        产品特点：{features_text}
        
        要求：
        1. 吸引眼球的设计
        2. 突出产品特色
        3. 适合在Instagram和微博使用
        4. 包含产品相关的视觉元素
        """
        
        return self.generate_with_chat(prompt)
    
    def create_presentation_slide(self, slide_title: str, key_points: List[str]) -> Dict:
        """
        创建演示文稿背景图
        """
        points_text = "\n".join([f"- {point}" for point in key_points])
        
        prompt = f"""
        请为演示文稿幻灯片创建背景图：
        
        幻灯片标题：{slide_title}
        要点：
        {points_text}
        
        要求：
        1. 专业商务风格
        2. 不要过于复杂，便于添加文字
        3. 色彩搭配符合商务场景
        4. 体现主题内容
        """
        
        return self.generate_with_chat(prompt)

# 使用示例
content_agent = ContentCreationAgent("your_api_key")

# 创建博客插图
blog_result = content_agent.create_blog_illustration(
    "人工智能在医疗领域的应用",
    "探讨AI技术如何革命性地改变医疗诊断、治疗和药物研发等领域"
)

# 创建产品宣传图
product_result = content_agent.create_social_media_post(
    "智能手表Pro",
    ["健康监测", "长续航", "防水设计", "智能语音"]
)

# 创建演示背景
slide_result = content_agent.create_presentation_slide(
    "2024年市场趋势分析",
    ["数字化转型加速", "用户体验重要性提升", "可持续发展成为关键"]
)
```

### 2. 电商应用

```python
class EcommerceImageAgent(ImageGenerationAgent):
    def create_product_mockup(self, product_description: str, usage_scenario: str) -> Dict:
        """
        创建产品使用场景图
        """
        prompt = f"""
        请创建产品使用场景图：
        
        产品描述：{product_description}
        使用场景：{usage_scenario}
        
        要求：
        1. 真实的使用环境
        2. 突出产品特色
        3. 生活化的场景设置
        4. 高质量的视觉效果
        """
        
        return self.generate_with_chat(prompt)
    
    def create_banner_design(self, promotion_theme: str, discount_info: str) -> Dict:
        """
        创建促销横幅设计
        """
        prompt = f"""
        请设计一个促销横幅：
        
        促销主题：{promotion_theme}
        优惠信息：{discount_info}
        
        要求：
        1. 醒目的视觉效果
        2. 突出优惠信息
        3. 符合电商平台风格
        4. 吸引用户点击
        """
        
        return self.generate_with_chat(prompt)
    
    def create_category_icon(self, category_name: str, style_preference: str = "modern") -> Dict:
        """
        创建商品分类图标
        """
        prompt = f"""
        请设计一个商品分类图标：
        
        分类名称：{category_name}
        设计风格：{style_preference}
        
        要求：
        1. 简洁明了的设计
        2. 易于识别和理解
        3. 适合小尺寸显示
        4. 与分类内容相关
        """
        
        return self.generate_with_chat(prompt)

# 使用示例
ecommerce_agent = EcommerceImageAgent("your_api_key")

# 创建产品场景图
mockup_result = ecommerce_agent.create_product_mockup(
    "无线蓝牙耳机，降噪功能，长续航",
    "年轻人在咖啡厅工作时使用"
)

# 创建促销横幅
banner_result = ecommerce_agent.create_banner_design(
    "双十一大促",
    "全场5折起，满299减50"
)

# 创建分类图标
icon_result = ecommerce_agent.create_category_icon(
    "数码配件",
    "扁平化设计"
)
```

### 3. 教育培训

```python
class EducationImageAgent(ImageGenerationAgent):
    def create_concept_illustration(self, concept: str, target_audience: str) -> Dict:
        """
        创建概念解释插图
        """
        prompt = f"""
        请为教育内容创建概念插图：
        
        概念：{concept}
        目标受众：{target_audience}
        
        要求：
        1. 易于理解的视觉表达
        2. 符合目标受众的认知水平
        3. 准确表达概念内容
        4. 有助于记忆和理解
        """
        
        return self.generate_with_chat(prompt)
    
    def create_process_diagram(self, process_name: str, steps: List[str]) -> Dict:
        """
        创建流程图解
        """
        steps_text = "\n".join([f"{i+1}. {step}" for i, step in enumerate(steps)])
        
        prompt = f"""
        请创建流程图解：
        
        流程名称：{process_name}
        步骤：
        {steps_text}
        
        要求：
        1. 清晰的步骤展示
        2. 逻辑流向明确
        3. 视觉层次分明
        4. 便于教学使用
        """
        
        return self.generate_with_chat(prompt)
    
    def create_historical_scene(self, historical_event: str, time_period: str) -> Dict:
        """
        创建历史场景重现图
        """
        prompt = f"""
        请重现历史场景：
        
        历史事件：{historical_event}
        时间期：{time_period}
        
        要求：
        1. 符合历史背景
        2. 准确的服饰和建筑风格
        3. 生动的场景描绘
        4. 有助于历史教学
        """
        
        return self.generate_with_chat(prompt)

# 使用示例
edu_agent = EducationImageAgent("your_api_key")

# 创建概念插图
concept_result = edu_agent.create_concept_illustration(
    "光合作用的过程",
    "中学生"
)

# 创建流程图
process_result = edu_agent.create_process_diagram(
    "软件开发流程",
    ["需求分析", "系统设计", "编码实现", "测试验证", "部署上线"]
)

# 创建历史场景
history_result = edu_agent.create_historical_scene(
    "丝绸之路贸易",
    "唐朝"
)
```

## 高级功能

### 1. 批量图像生成

```python
class BatchImageGenerator(ImageGenerationAgent):
    def generate_image_series(self, base_prompt: str, variations: List[str]) -> List[Dict]:
        """
        生成系列图像
        """
        results = []
        
        for i, variation in enumerate(variations):
            full_prompt = f"{base_prompt}, {variation}"
            print(f"生成图像 {i+1}/{len(variations)}: {variation}")
            
            try:
                result = self.generate_image(full_prompt)
                results.append({
                    "variation": variation,
                    "result": result
                })
            except Exception as e:
                results.append({
                    "variation": variation,
                    "error": str(e)
                })
        
        return results
    
    def generate_style_variations(self, prompt: str, styles: List[str]) -> List[Dict]:
        """
        生成不同风格的图像
        """
        results = []
        
        for style in styles:
            styled_prompt = f"{prompt}, {style} style"
            
            try:
                result = self.generate_image(styled_prompt)
                results.append({
                    "style": style,
                    "result": result
                })
            except Exception as e:
                results.append({
                    "style": style,
                    "error": str(e)
                })
        
        return results
    
    def generate_size_variants(self, prompt: str, sizes: List[str]) -> List[Dict]:
        """
        生成不同尺寸的图像
        """
        results = []
        
        for size in sizes:
            try:
                result = self.generate_image(prompt, size=size)
                results.append({
                    "size": size,
                    "result": result
                })
            except Exception as e:
                results.append({
                    "size": size,
                    "error": str(e)
                })
        
        return results

# 使用示例
batch_generator = BatchImageGenerator("your_api_key")

# 生成系列产品图
product_series = batch_generator.generate_image_series(
    "现代简约风格的椅子",
    ["红色布料", "黑色皮革", "白色塑料", "木质材料"]
)

# 生成不同风格
style_variants = batch_generator.generate_style_variations(
    "山水风景",
    ["水彩画", "油画", "素描", "数字艺术", "中国画"]
)

# 生成不同尺寸
size_variants = batch_generator.generate_size_variants(
    "企业logo设计，简洁现代",
    ["1024x1024", "1024x1792", "1792x1024"]
)
```

### 2. 图像质量评估

```python
class ImageQualityAssessment:
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.chat_url = "https://open.bigmodel.cn/api/paas/v4/chat/completions"
    
    def assess_image_quality(self, image_url: str, criteria: List[str]) -> Dict:
        """
        评估图像质量
        """
        criteria_text = "\n".join([f"- {criterion}" for criterion in criteria])
        
        prompt = f"""
        请评估这张图像的质量，评估标准：
        {criteria_text}
        
        请从以下方面进行评分（1-10分）：
        1. 整体质量
        2. 色彩搭配
        3. 构图布局
        4. 细节表现
        5. 风格一致性
        
        并提供改进建议。
        """
        
        headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {self.api_key}"
        }
        
        data = {
            "model": "glm-4v-plus",
            "messages": [
                {
                    "role": "user",
                    "content": [
                        {"type": "text", "text": prompt},
                        {"type": "image_url", "image_url": {"url": image_url}}
                    ]
                }
            ]
        }
        
        response = requests.post(self.chat_url, headers=headers, json=data)
        result = response.json()
        
        if 'choices' in result:
            return {
                "success": True,
                "assessment": result['choices'][0]['message']['content']
            }
        
        return {"success": False, "error": "评估失败"}
    
    def compare_images(self, image_urls: List[str], comparison_criteria: str) -> Dict:
        """
        比较多张图像
        """
        prompt = f"""
        请比较这些图像，比较标准：{comparison_criteria}
        
        请分析：
        1. 各图像的优缺点
        2. 哪张图像最符合要求
        3. 改进建议
        """
        
        content = [{"type": "text", "text": prompt}]
        
        for i, url in enumerate(image_urls):
            content.append({
                "type": "image_url",
                "image_url": {"url": url}
            })
        
        headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {self.api_key}"
        }
        
        data = {
            "model": "glm-4v-plus",
            "messages": [{"role": "user", "content": content}]
        }
        
        response = requests.post(self.chat_url, headers=headers, json=data)
        result = response.json()
        
        if 'choices' in result:
            return {
                "success": True,
                "comparison": result['choices'][0]['message']['content']
            }
        
        return {"success": False, "error": "比较失败"}
```

### 3. 智能提示词优化

```python
class PromptOptimizer:
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.chat_url = "https://open.bigmodel.cn/api/paas/v4/chat/completions"
    
    def optimize_prompt(self, original_prompt: str, target_style: str = None, 
                      target_quality: str = "high") -> str:
        """
        优化图像生成提示词
        """
        optimization_request = f"""
        请优化以下图像生成提示词，使其能够生成更高质量的图像：
        
        原始提示词：{original_prompt}
        目标风格：{target_style or '不限'}
        质量要求：{target_quality}
        
        请添加：
        1. 具体的视觉细节描述
        2. 光线和色彩信息
        3. 构图和视角建议
        4. 艺术风格指定
        5. 质量关键词
        
        只返回优化后的提示词，不要解释。
        """
        
        headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {self.api_key}"
        }
        
        data = {
            "model": "glm-4-plus",
            "messages": [{"role": "user", "content": optimization_request}],
            "temperature": 0.7
        }
        
        response = requests.post(self.chat_url, headers=headers, json=data)
        result = response.json()
        
        if 'choices' in result:
            return result['choices'][0]['message']['content'].strip()
        
        return original_prompt
    
    def generate_prompt_variations(self, base_prompt: str, num_variations: int = 3) -> List[str]:
        """
        生成提示词变体
        """
        variation_request = f"""
        基于以下提示词，生成{num_variations}个不同的变体，每个变体应该：
        1. 保持核心主题不变
        2. 添加不同的细节描述
        3. 使用不同的表达方式
        4. 可能产生不同的视觉效果
        
        原始提示词：{base_prompt}
        
        请分别列出{num_variations}个变体，每行一个：
        """
        
        headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {self.api_key}"
        }
        
        data = {
            "model": "glm-4-plus",
            "messages": [{"role": "user", "content": variation_request}],
            "temperature": 0.8
        }
        
        response = requests.post(self.chat_url, headers=headers, json=data)
        result = response.json()
        
        if 'choices' in result:
            variations_text = result['choices'][0]['message']['content']
            variations = [v.strip() for v in variations_text.split('\n') if v.strip()]
            return variations[:num_variations]
        
        return [base_prompt]
```

## 最佳实践

### 1. 提示词编写技巧

```python
class PromptBestPractices:
    @staticmethod
    def create_detailed_prompt(subject: str, style: str, composition: str, 
                             lighting: str, color_scheme: str, quality_keywords: List[str]) -> str:
        """
        创建详细的提示词
        """
        quality_text = ", ".join(quality_keywords)
        
        prompt = f"""
        {subject}, {style} style, {composition}, {lighting}, {color_scheme}, 
        {quality_text}, highly detailed, professional photography, 
        sharp focus, vivid colors, masterpiece
        """
        
        return prompt.strip()
    
    @staticmethod
    def add_negative_prompts(positive_prompt: str, negative_elements: List[str]) -> str:
        """
        添加负面提示词（避免不想要的元素）
        """
        negative_text = ", ".join(negative_elements)
        return f"{positive_prompt} --no {negative_text}"
    
    @staticmethod
    def create_character_prompt(character_description: str, pose: str, 
                              background: str, art_style: str) -> str:
        """
        创建角色图像提示词
        """
        return f"""
        {character_description}, {pose}, {background}, {art_style}, 
        detailed facial features, expressive eyes, high quality, 
        professional illustration, clean lines, vibrant colors
        """

# 使用示例
prompt_helper = PromptBestPractices()

# 创建详细提示词
detailed_prompt = prompt_helper.create_detailed_prompt(
    subject="一只优雅的白色波斯猫",
    style="写实摄影",
    composition="特写镜头，三分法构图",
    lighting="柔和的自然光",
    color_scheme="暖色调",
    quality_keywords=["8K分辨率", "专业摄影", "锐利对焦"]
)

# 创建角色提示词
character_prompt = prompt_helper.create_character_prompt(
    character_description="年轻的女性程序员，短发，戴眼镜",
    pose="坐在电脑前专注工作",
    background="现代办公室环境",
    art_style="现代插画风格"
)
```

### 2. 图像管理和组织

```python
import os
import json
from datetime import datetime
from typing import Dict, List

class ImageManager:
    def __init__(self, storage_dir: str = "./generated_images"):
        self.storage_dir = storage_dir
        self.metadata_file = os.path.join(storage_dir, "metadata.json")
        os.makedirs(storage_dir, exist_ok=True)
        self.metadata = self._load_metadata()
    
    def save_image_with_metadata(self, image_url: str, prompt: str, 
                               category: str, tags: List[str] = None) -> str:
        """
        保存图像并记录元数据
        """
        # 生成文件名
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        filename = f"{category}_{timestamp}.png"
        filepath = os.path.join(self.storage_dir, filename)
        
        # 下载图像
        response = requests.get(image_url)
        with open(filepath, 'wb') as f:
            f.write(response.content)
        
        # 保存元数据
        metadata = {
            "filename": filename,
            "prompt": prompt,
            "category": category,
            "tags": tags or [],
            "created_at": datetime.now().isoformat(),
            "original_url": image_url
        }
        
        self.metadata[filename] = metadata
        self._save_metadata()
        
        return filepath
    
    def search_images(self, query: str = None, category: str = None, 
                     tags: List[str] = None) -> List[Dict]:
        """
        搜索图像
        """
        results = []
        
        for filename, metadata in self.metadata.items():
            match = True
            
            if query and query.lower() not in metadata['prompt'].lower():
                match = False
            
            if category and metadata['category'] != category:
                match = False
            
            if tags:
                if not any(tag in metadata['tags'] for tag in tags):
                    match = False
            
            if match:
                results.append(metadata)
        
        return results
    
    def _load_metadata(self) -> Dict:
        """
        加载元数据
        """
        if os.path.exists(self.metadata_file):
            with open(self.metadata_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        return {}
    
    def _save_metadata(self):
        """
        保存元数据
        """
        with open(self.metadata_file, 'w', encoding='utf-8') as f:
            json.dump(self.metadata, f, ensure_ascii=False, indent=2)

# 使用示例
image_manager = ImageManager()

# 生成并保存图像
agent = ImageGenerationAgent("your_api_key")
result = agent.generate_image("现代办公室设计，简约风格")

if result['success']:
    saved_path = image_manager.save_image_with_metadata(
        image_url=result['image_url'],
        prompt="现代办公室设计，简约风格",
        category="interior_design",
        tags=["办公室", "现代", "简约"]
    )
    print(f"图像已保存到: {saved_path}")

# 搜索图像
office_images = image_manager.search_images(category="interior_design", tags=["办公室"])
print(f"找到 {len(office_images)} 张办公室设计图")
```

## 注意事项

### 使用限制
- 生成速度：每张图像需要几秒到几十秒
- 内容限制：避免生成违法、有害或侵权内容
- 质量变化：结果可能因提示词而异
- 成本考虑：高质量图像消耗更多tokens

### 版权和合规
- 生成的图像可能涉及版权问题
- 避免模仿特定艺术家的风格
- 不要生成真实人物的肖像
- 遵守平台使用条款

<Warning>
图像生成功能需要谨慎使用。确保：
1. 遵守相关法律法规
2. 尊重知识产权
3. 避免生成不当内容
4. 合理控制使用成本
</Warning>

<Tip>
为了获得更好的图像质量，建议：
1. 使用详细和具体的描述
2. 指定艺术风格和技术参数
3. 多次尝试不同的提示词
4. 结合负面提示词避免不想要的元素
</Tip>