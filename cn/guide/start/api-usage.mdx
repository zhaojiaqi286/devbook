---
title: "调用方式"
description: "智谱AI API调用方式详解"
---

# 调用方式

智谱AI开放平台提供标准的RESTful API接口，支持多种编程语言和调用方式。

## 基础配置

### API端点

```
https://open.bigmodel.cn/api/paas/v4/
```

### 认证方式

所有API请求都需要在请求头中包含API Key：

```http
Authorization: Bearer YOUR_API_KEY
Content-Type: application/json
```

### 请求格式

所有请求都使用JSON格式，采用POST方法。

## 语言模型调用

### 基础对话

```bash
curl -X POST "https://open.bigmodel.cn/api/paas/v4/chat/completions" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "model": "glm-4-plus",
    "messages": [
      {
        "role": "user",
        "content": "你好，请介绍一下你自己"
      }
    ],
    "temperature": 0.7,
    "max_tokens": 1000
  }'
```

### 流式响应

对于长文本生成，建议使用流式响应：

```bash
curl -X POST "https://open.bigmodel.cn/api/paas/v4/chat/completions" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "model": "glm-4-plus",
    "messages": [
      {
        "role": "user",
        "content": "请写一篇关于人工智能的文章"
      }
    ],
    "stream": true
  }'
```

## 多模态调用

### 图像理解

```bash
curl -X POST "https://open.bigmodel.cn/api/paas/v4/chat/completions" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "model": "glm-4v-plus",
    "messages": [
      {
        "role": "user",
        "content": [
          {
            "type": "text",
            "text": "请描述这张图片的内容"
          },
          {
            "type": "image_url",
            "image_url": {
              "url": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
            }
          }
        ]
      }
    ]
  }'
```

## 工具调用

### 网络搜索

```bash
curl -X POST "https://open.bigmodel.cn/api/paas/v4/chat/completions" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "model": "glm-4-plus",
    "messages": [
      {
        "role": "user",
        "content": "请搜索最新的人工智能新闻"
      }
    ],
    "tools": [
      {
        "type": "web_search",
        "web_search": {
          "enable": true
        }
      }
    ]
  }'
```

## 视频生成调用

### CogVideoX-2

```bash
curl -X POST "https://open.bigmodel.cn/api/paas/v4/videos/generations" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "model": "cogvideox-2",
    "prompt": "一只可爱的小猫在花园里玩耍",
    "duration": 5,
    "resolution": "720p"
  }'
```

## 编程语言示例

### Python

```python
import requests
import json

class ZhipuAI:
    def __init__(self, api_key):
        self.api_key = api_key
        self.base_url = "https://open.bigmodel.cn/api/paas/v4"
        self.headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {api_key}"
        }
    
    def chat(self, model, messages, **kwargs):
        url = f"{self.base_url}/chat/completions"
        data = {
            "model": model,
            "messages": messages,
            **kwargs
        }
        response = requests.post(url, headers=self.headers, json=data)
        return response.json()
    
    def generate_video(self, model, prompt, **kwargs):
        url = f"{self.base_url}/videos/generations"
        data = {
            "model": model,
            "prompt": prompt,
            **kwargs
        }
        response = requests.post(url, headers=self.headers, json=data)
        return response.json()

# 使用示例
client = ZhipuAI("your_api_key")

# 文本对话
response = client.chat(
    model="glm-4-plus",
    messages=[
        {"role": "user", "content": "你好"}
    ]
)
print(response)

# 视频生成
video_response = client.generate_video(
    model="cogvideox-2",
    prompt="美丽的日落景色",
    duration=5
)
print(video_response)
```

### JavaScript/Node.js

```javascript
const axios = require('axios');

class ZhipuAI {
    constructor(apiKey) {
        this.apiKey = apiKey;
        this.baseURL = 'https://open.bigmodel.cn/api/paas/v4';
        this.headers = {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
        };
    }

    async chat(model, messages, options = {}) {
        const url = `${this.baseURL}/chat/completions`;
        const data = {
            model,
            messages,
            ...options
        };
        
        try {
            const response = await axios.post(url, data, { headers: this.headers });
            return response.data;
        } catch (error) {
            throw new Error(`API调用失败: ${error.message}`);
        }
    }

    async generateVideo(model, prompt, options = {}) {
        const url = `${this.baseURL}/videos/generations`;
        const data = {
            model,
            prompt,
            ...options
        };
        
        try {
            const response = await axios.post(url, data, { headers: this.headers });
            return response.data;
        } catch (error) {
            throw new Error(`视频生成失败: ${error.message}`);
        }
    }
}

// 使用示例
const client = new ZhipuAI('your_api_key');

// 文本对话
client.chat('glm-4-plus', [
    { role: 'user', content: '你好' }
]).then(response => {
    console.log(response);
}).catch(error => {
    console.error(error);
});
```

### Java

```java
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.net.URI;
import java.time.Duration;

public class ZhipuAI {
    private final String apiKey;
    private final String baseUrl = "https://open.bigmodel.cn/api/paas/v4";
    private final HttpClient client;
    
    public ZhipuAI(String apiKey) {
        this.apiKey = apiKey;
        this.client = HttpClient.newBuilder()
            .connectTimeout(Duration.ofSeconds(30))
            .build();
    }
    
    public String chat(String model, String jsonMessages) throws Exception {
        String requestBody = String.format(
            "{\"model\":\"%s\",\"messages\":%s}",
            model, jsonMessages
        );
        
        HttpRequest request = HttpRequest.newBuilder()
            .uri(URI.create(baseUrl + "/chat/completions"))
            .header("Content-Type", "application/json")
            .header("Authorization", "Bearer " + apiKey)
            .POST(HttpRequest.BodyPublishers.ofString(requestBody))
            .build();
            
        HttpResponse<String> response = client.send(request, 
            HttpResponse.BodyHandlers.ofString());
            
        return response.body();
    }
}
```

### Go

```go
package main

import (
    "bytes"
    "encoding/json"
    "fmt"
    "io"
    "net/http"
)

type ZhipuAI struct {
    APIKey  string
    BaseURL string
    Client  *http.Client
}

type ChatRequest struct {
    Model    string    `json:"model"`
    Messages []Message `json:"messages"`
}

type Message struct {
    Role    string `json:"role"`
    Content string `json:"content"`
}

func NewZhipuAI(apiKey string) *ZhipuAI {
    return &ZhipuAI{
        APIKey:  apiKey,
        BaseURL: "https://open.bigmodel.cn/api/paas/v4",
        Client:  &http.Client{},
    }
}

func (z *ZhipuAI) Chat(model string, messages []Message) (string, error) {
    reqBody := ChatRequest{
        Model:    model,
        Messages: messages,
    }
    
    jsonData, err := json.Marshal(reqBody)
    if err != nil {
        return "", err
    }
    
    req, err := http.NewRequest("POST", z.BaseURL+"/chat/completions", bytes.NewBuffer(jsonData))
    if err != nil {
        return "", err
    }
    
    req.Header.Set("Content-Type", "application/json")
    req.Header.Set("Authorization", "Bearer "+z.APIKey)
    
    resp, err := z.Client.Do(req)
    if err != nil {
        return "", err
    }
    defer resp.Body.Close()
    
    body, err := io.ReadAll(resp.Body)
    if err != nil {
        return "", err
    }
    
    return string(body), nil
}

func main() {
    client := NewZhipuAI("your_api_key")
    
    messages := []Message{
        {Role: "user", Content: "你好"},
    }
    
    response, err := client.Chat("glm-4-plus", messages)
    if err != nil {
        fmt.Printf("错误: %v\n", err)
        return
    }
    
    fmt.Println(response)
}
```

### PHP

```php
<?php

class ZhipuAI {
    private $apiKey;
    private $baseUrl = 'https://open.bigmodel.cn/api/paas/v4';
    
    public function __construct($apiKey) {
        $this->apiKey = $apiKey;
    }
    
    public function chat($model, $messages, $options = []) {
        $url = $this->baseUrl . '/chat/completions';
        
        $data = array_merge([
            'model' => $model,
            'messages' => $messages
        ], $options);
        
        $headers = [
            'Content-Type: application/json',
            'Authorization: Bearer ' . $this->apiKey
        ];
        
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
        curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        
        $response = curl_exec($ch);
        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        curl_close($ch);
        
        if ($httpCode !== 200) {
            throw new Exception('API调用失败，HTTP状态码: ' . $httpCode);
        }
        
        return json_decode($response, true);
    }
}

// 使用示例
$client = new ZhipuAI('your_api_key');

$messages = [
    ['role' => 'user', 'content' => '你好']
];

try {
    $response = $client->chat('glm-4-plus', $messages);
    echo json_encode($response, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE);
} catch (Exception $e) {
    echo '错误: ' . $e->getMessage();
}

?>
```

## 错误处理

### 常见错误码

| 错误码 | 说明 | 解决方案 |
|--------|------|----------|
| 401 | 认证失败 | 检查API Key是否正确 |
| 429 | 请求频率超限 | 降低请求频率或升级套餐 |
| 400 | 请求参数错误 | 检查请求格式和参数 |
| 500 | 服务器内部错误 | 稍后重试或联系技术支持 |

### 错误响应格式

```json
{
  "error": {
    "code": "invalid_request_error",
    "message": "请求参数错误",
    "type": "invalid_request_error"
  }
}
```

## 最佳实践

### 1. 请求优化

- 使用合适的模型：根据任务复杂度选择模型
- 控制输入长度：避免不必要的长文本
- 设置合理的参数：temperature、max_tokens等

### 2. 错误重试

```python
import time
import random

def retry_with_backoff(func, max_retries=3):
    for attempt in range(max_retries):
        try:
            return func()
        except Exception as e:
            if attempt == max_retries - 1:
                raise e
            wait_time = (2 ** attempt) + random.uniform(0, 1)
            time.sleep(wait_time)
```

### 3. 流量控制

- 实现请求队列
- 监控API使用量
- 设置合理的并发限制

### 4. 安全考虑

- 妥善保管API Key
- 使用HTTPS协议
- 验证输入内容
- 记录API调用日志

<Warning>
请勿在客户端代码中直接暴露API Key，建议通过后端服务进行API调用。
</Warning>